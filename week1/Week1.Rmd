---
title: 'Week 1: Introduction/Connecting to our Database'
author: "Ted Laderas"
date: "June 21, 2019"
output: html_notebook
---

## Learning Objectives

By the end of this notebook, you will hopefully learn the following.

1. Learn the basics behind RStudio Cloud and Notebooks
2. Learn what a `data.frame` is
3. Understand some basic summaries on a `data.frame`
4. Connect to our database and summarize it.

## RStudio Cloud and Notebooks

If you're reading this, welcome to BMI569 in RStudio Cloud! It's a cloud based instance of RStudio, which is accessible anywhere in the web. We'll be doing our assignments in it. 

All of the software packages that you need for this course has been preinstalled. As we get more advanced, I'll show you how to install other packages as well.

Notebooks are part of what is called *literate programming*, where code is accompanied by textual explanations. What you're reading now is normal text.

Below is a code block, which lets you execute code in the console window. Try hitting the green play button on the top right. 

```{r}
1 / 3
```

You should see a window with the code output below. 

Do you want more info about how notebooks work? Here's a video: 

## Saving your work

Be sure to save your work after you're done (under "File > Save"). 

## Submitting Homework

When you start running code in a notebook, you'll notice that a `Week1.nb.html` file is also generated in the same folder as your work. That's what I want you to submit as your submission for an assignment in Sakai.

Assignments will usually be in their own notebooks.

## Motivation for Prework

The LACE score is a summary score used in clinical data that is derived from 4 key clinical data elements in order to predict the probability of 30-day readmissions. Here are the individual elements of the LACE score:

* L = Length of stay
* A = Acuity of admission
* C = Comorbidities (scored by severity, and additive)
* E = Number of Emergency room admits 6 months prior to admission

In class on-campus, we will calculate each of these elements. Added together, the LACE score ranges from 1-14. The higher the score, the higher the probability of readmission.

Your overall goal in the pre-work will be to identify those cases in the dataset that are readmissions within a 30 day period. These are the cases for which we will then calculate the LACE score (in-class, on-campus) and examine how well it predicts readmissions.

In order to achieve this goal, we will be slowly be exploring R and SQL over the next eight weeks of on-campus work.

## Loading a built-in dataset and doing some summary statistics

Your first thing to notice is that there are two main windows on your left: The console window (the bottom window) and the scripting window (the top window). We will mostly work by writing scripts in scripting window and executing them in the console window by highlighting the code and using the Run command or CTRL-Enter (for Windows/Linux) or CMD-Enter (for Macs).

![RStudio Console Image](image/consolewindow.jpg)

In this code chunk, we load the built in `iris` dataset with the `data()` function. This loads in a built in dataset called `iris`. Try this, and try getting help on this dataset by using `?iris`.

```{r}
data(iris)

```

Try getting help on `iris` by running the following:

```{r}
?iris
```

If there's a function that you don't know, using the `?` before the command name will pop up the help file.

After reading the help file, we now know that the iris dataset is in `data.frame` format. This is the basic format that we'll be using for tables in R. We'll explore some properties of the data.frame to get used to them. 

The first thing is to look at the data directly. If we use the `head()` command we can see the first few rows of the iris data. Each row in the `iris` data corresponds to a single flower that has been measured, and each column corresponds to a variable that was measured on that flower. 

```{r}
head(iris)
```

**QUESTION**: How many rows did `head()` return? 

We may want to know more information about the dataset. We can do some simple summary statistics by using the `summary()` function. Depending on the datatype of the column (numeric, character, or factor), we can calculate different summary statistics on the dataset. 

```{r}
summary(iris)
```

We might also want to know how many columns and rows there are in the dataset. We can use the `ncol()` and `nrow()` commands to find these:

```{r}
nrow(iris)
ncol(iris)
```

## Some terminology

Usually for our data, the rows and columns have some meaning. In a `data.frame`, the columns represent different variables, and can have different types. For example, the `Species` column in the `iris` table is actually called a `factor`. `factor`s are R's special way of representing categorical data. On the other hand, the `Sepal.Width` column of `iris` is `numeric`, because it's representing a continous variable.

The rows represent different observations. What do the rows represent in the `patient` table?

## Good Job!

Take a break before moving on.


## Connecting to our Database

Ok, we've looked at some built in data. How about the data for the class?

Our data lives in a database, which is in the `data/` folder of this project. The database is in a format called SQLite. SQLite is a database engine that's open-source and is widely used. We'll use it to simulate our data warehouse that we will calculate our analytics on. We'll learn Structured Query Language (SQL), which will let us query our patient database. As we move on, we'll do more and more complicated queries with the database. 

QUESTION: What is the database named? (Hint: look in the `data/` folder.)

We're going to use a library, which is bit of code that extends R's functionality. We need to open a connection to our database.

```{r}
library(RSQLite)
library(here)
#start our connection to the database
con <- DBI::dbConnect(RSQLite::SQLite(), here("data/patient1.sqlite"))
```

Okay, nothing happened. But now we can use `dbListTables()`, a function to list the tables in the database. Try running it and look at the output.

```{r}
#list all of the tables in the database
dbListTables(con)
```

QUESTION: How many tables are there in the database?

What if we want to actually look at one of the tables? We can use our connection along with the `tbl()` function to query the table.

```{r}
#get the patient table
patient_table <- tbl(src=con, from="patient") 
```


```{r}
patient_table
```

## The Difference Between In-memory and a Connection

Did you try to look at the number of rows in `patient_table`? Something funny happens:

```{r}

nrow(patient_table)
```

Huh, that's weird. The reason for this is that we're only seeing the first few rows of the dataset. The SQLite connection is cautious - it only returns a smaller subset of the rows than are actually in the database. 

We can force the database to give us all the data by using the `collect()` function on our `patient_table` object.

```{r}
patient_table <- tbl(con, "patient") 
patient_table_inmemory <- collect(patient_table)
```

## Wrapping Up

The last thing we want to do is disconnect from our database. When you are writing information into the database, disconnecting will save that information.

```{r}
dbDisconnect(con)
```


## Assignment Week 1 (1 point)

Answer these questions about the `patient` table in the database in `week1Submission.Rmd`. Show your code in your submitted notebook that you used to answer the question.

1) How many rows are there?
2) What variables are missing all information (represented by `NA`s) and why might it be missing?
3) What is the maximum `riskscore` value?

